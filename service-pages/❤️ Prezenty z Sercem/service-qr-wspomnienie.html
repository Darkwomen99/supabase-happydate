<!DOCTYPE html>
<html lang="pl" class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white transition-colors">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>QR‑Wspomnienie — Prezenty z sercem | HappyDate</title>

  <!-- SEO -->
  <meta name="description" content="Zachowaj pamięć o bliskiej osobie: wygeneruj wodoodporny kod QR prowadzący do strony ze zdjęciami, filmami i wspomnieniami. Druk + wysyłka." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://www.happydate.pl/service-pages/Prezenty-z-SerceM/service-qr-wspomnienie.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="QR‑Wspomnienie — pamięć, która nie znika" />
  <meta property="og:description" content="Wodoodporny kod QR na nagrobek, prowadzący do prywatnej strony ze wspomnieniami." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.happydate.pl/service-pages/Prezenty-z-SerceM/service-qr-wspomnienie.html" />
  <meta property="og:image" content="/assets/img/social-banner.jpg" />

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media (prefers-reduced-motion: reduce){.animate-bounce,.animate-ping,.animate-pulse{animation:none!important}}
    dialog::backdrop{background:rgba(0,0,0,.35)}
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header (spójny z innymi stronami) -->
  <header class="bg-gradient-to-r from-blue-400 to-cyan-400 py-3 sticky top-0 z-50 shadow-none" aria-label="Główna nawigacja">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-4">
      <a href="/index.html" class="text-2xl font-bold text-white hover:underline" aria-label="HappyDate — Strona główna">🎁 HappyDate</a>
      <nav class="hidden sm:flex gap-5 items-center text-white font-medium" aria-label="Główne menu">
        <a href="/index.html" class="hover:underline">Strona główna</a>
        <a href="/pages/services.html" class="hover:underline">Usługi</a>
        <a href="/pages/dashboard.html" class="hover:underline">Moje wydarzenia</a>
        <a href="/pages/partnerstwo.html" class="hover:underline">Partnerstwo</a>
        <a href="/pages/about.html" class="hover:underline">O nas</a>
        <a href="/pages/reviews.html" class="hover:underline">Opinie</a>
      </nav>
    </div>
  </header>

  <!-- Toast -->
  <div id="toast" class="fixed top-6 right-6 z-50 px-4 py-3 rounded-xl bg-gray-900 text-white shadow-xl transition-all duration-300 opacity-0 pointer-events-none" role="status" aria-live="polite"></div>

  <main class="flex-1 bg-gradient-to-br from-pink-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800">
    <!-- Hero -->
    <section class="px-4 py-14">
      <div class="max-w-5xl mx-auto bg-white/80 dark:bg-gray-800/80 backdrop-blur rounded-3xl shadow-2xl border border-blue-100 dark:border-gray-700 p-8 md:p-12">
        <div class="flex flex-col md:flex-row gap-10 items-center">
          <div class="flex-1">
            <span class="inline-block bg-gradient-to-r from-pink-500 to-cyan-500 text-white font-bold px-4 py-1 rounded-full text-sm mb-3">Prezenty z sercem</span>
            <h1 class="text-4xl md:text-5xl font-extrabold leading-tight mb-3">QR‑Wspomnienie — pamięć, która nie znika</h1>
            <p class="text-gray-700 dark:text-gray-300 text-lg">Stwórz prywatną stronę wspomnienia z <strong>zdjęciami</strong>, <strong>filmami</strong> i opisem. Otrzymasz <strong>wodoodporną naklejkę</strong> z kodem QR do umieszczenia na nagrobku.</p>
            <ul class="mt-4 space-y-2 text-gray-700 dark:text-gray-300">
              <li>• Bezpieczne przechowywanie w chmurze</li>
              <li>• Prywatny dostęp przez unikalny link</li>
              <li>• Możliwość edycji i usunięcia na życzenie</li>
            </ul>
          </div>
          <div class="flex-1 w-full">
            <div class="rounded-2xl border border-blue-100 dark:border-gray-700 bg-white dark:bg-gray-900 p-6 shadow-xl">
              <h2 class="text-xl font-bold mb-3">Podgląd kodu QR</h2>
              <div id="qrPreview" class="flex items-center justify-center h-52 rounded-xl bg-gray-50 dark:bg-gray-800"></div>
              <p class="mt-3 text-xs text-gray-500">Podgląd jest orientacyjny. Finalny nadruk wykonujemy na naklejce odpornej na warunki zewnętrzne.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pricing -->
    <section class="px-4">
      <div class="max-w-5xl mx-auto grid md:grid-cols-3 gap-4 mb-10">
        <article class="rounded-2xl border bg-white dark:bg-gray-800 border-blue-100 dark:border-gray-700 p-6 shadow">
          <h3 class="font-bold text-lg">Basic</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">1 zdjęcie + krótki opis + 1 naklejka</p>
          <p class="text-2xl font-extrabold mt-2">149 zł</p>
        </article>
        <article class="rounded-2xl border bg-white dark:bg-gray-800 border-blue-100 dark:border-gray-700 p-6 shadow">
          <h3 class="font-bold text-lg">Plus</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">Galeria do 15 zdjęć/filmów + 2 naklejki</p>
          <p class="text-2xl font-extrabold mt-2">199 zł</p>
        </article>
        <article class="rounded-2xl border bg-white dark:bg-gray-800 border-blue-100 dark:border-gray-700 p-6 shadow">
          <h3 class="font-bold text-lg">Premium</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400">Nieograniczona galeria + muzyka + 3 naklejki</p>
          <p class="text-2xl font-extrabold mt-2">249 zł</p>
        </article>
      </div>
    </section>

    <!-- Form -->
    <section class="px-4 pb-16">
      <form id="memorialForm" class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-3xl shadow-2xl border border-blue-100 dark:border-gray-700 p-6 md:p-10 space-y-6" novalidate>
        <h2 class="text-2xl font-bold">Utwórz stronę wspomnienia</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 -mt-2">Pola oznaczone <span class="text-pink-500">*</span> są wymagane.</p>

        <div class="grid md:grid-cols-2 gap-4">
          <label class="block text-sm font-medium">Imię i nazwisko osoby <span class="text-pink-500">*</span>
            <input id="fullName" required class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" placeholder="np. Jan Kowalski" />
          </label>
          <label class="block text-sm font-medium">Zakres dat (np. 1950–2024)
            <input id="lifespan" class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" placeholder="np. 1950–2024" />
          </label>
        </div>

        <label class="block text-sm font-medium">Krótki opis / wspomnienie <span class="text-pink-500">*</span>
          <textarea id="bio" required rows="3" class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" placeholder="Kilka słów od rodziny/znajomych..."></textarea>
        </label>

        <div class="grid md:grid-cols-2 gap-4">
          <label class="block text-sm font-medium">Zdjęcia (do 15)
            <input id="photos" type="file" accept="image/*" multiple class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" />
          </label>
          <label class="block text-sm font-medium">Filmy (krótkie)
            <input id="videos" type="file" accept="video/*" multiple class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" />
          </label>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <label class="block text-sm font-medium">Pakiet <span class="text-pink-500">*</span>
            <select id="plan" required class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900">
              <option value="">Wybierz pakiet…</option>
              <option value="basic">Basic — 149 zł</option>
              <option value="plus">Plus — 199 zł</option>
              <option value="premium">Premium — 249 zł</option>
            </select>
          </label>
          <label class="block text-sm font-medium">Ilość naklejek
            <input id="stickers" type="number" min="1" max="10" value="1" class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" />
          </label>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <label class="block text-sm font-medium">E-mail do kontaktu <span class="text-pink-500">*</span>
            <input id="email" type="email" required class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" placeholder="twoj@adres.pl" />
          </label>
          <label class="block text-sm font-medium">Telefon (opcjonalnie)
            <input id="phone" type="tel" class="mt-1 w-full border rounded-xl px-4 py-2 dark:bg-gray-900" placeholder="+48 ..." />
          </label>
        </div>

        <div class="flex items-start gap-3">
          <input id="consentData" type="checkbox" class="mt-1" required />
          <label for="consentData" class="text-sm text-gray-700 dark:text-gray-300">Oświadczam, że mam prawo udostępnić materiały oraz wyrażam zgodę na ich przetwarzanie zgodnie z <a href="/pages/privacy.html" class="underline" target="_blank" rel="noopener">Polityką prywatności</a>. <span class="text-pink-500">*</span></label>
        </div>
        <div class="flex items-start gap-3">
          <input id="consentPrint" type="checkbox" class="mt-1" required />
          <label for="consentPrint" class="text-sm text-gray-700 dark:text-gray-300">Wyrażam zgodę na przygotowanie i wysyłkę naklejki z kodem QR. <span class="text-pink-500">*</span></label>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 pt-2">
          <button id="generateBtn" type="button" class="flex-1 bg-pink-500 hover:bg-pink-600 text-white font-semibold py-3 rounded-xl shadow transition">Wygeneruj podgląd QR</button>
          <button id="orderBtn" type="submit" class="flex-1 border hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl py-3 font-semibold">Zamów naklejkę</button>
        </div>

        <p class="text-xs text-gray-500">Po złożeniu zamówienia przygotujemy stronę wspomnienia oraz nadruk. Link i status wyślemy na e‑mail.</p>
      </form>
    </section>

    <!-- FAQ / Info prawne -->
    <section class="px-4 pb-16">
      <div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-6">
        <article class="bg-white dark:bg-gray-800 rounded-2xl shadow border border-blue-100 dark:border-gray-700 p-6">
          <h3 class="font-bold text-lg mb-2">Prywatność i bezpieczeństwo</h3>
          <p class="text-sm text-gray-700 dark:text-gray-300">Materiały są przechowywane w chmurze (Supabase). Dostęp do strony wspomnienia jest prywatny (unikalny link/UUID). Na życzenie usuwamy wszystkie dane.</p>
        </article>
        <article class="bg-white dark:bg-gray-800 rounded-2xl shadow border border-blue-100 dark:border-gray-700 p-6">
          <h3 class="font-bold text-lg mb-2">Trwałość naklejki</h3>
          <p class="text-sm text-gray-700 dark:text-gray-300">Naklejka jest wodoodporna i odporna na promieniowanie UV. Zalecamy gładką, odtłuszczoną powierzchnię i docisk przez 30–60 s.</p>
        </article>
      </div>
    </section>
  </main>

  <footer class="bg-blue-500 text-white py-6" aria-label="Stopka HappyDate">
    <div class="max-w-4xl mx-auto text-center px-4 text-sm md:text-base">
      &copy; 2025 HappyDate. Z miłością tworzymy niezapomniane chwile. | <a href="/pages/privacy.html" class="underline hover:text-yellow-200">Polityka prywatności</a>
    </div>
  </footer>

  <!-- Modale -->
  <dialog id="orderOk" class="rounded-2xl shadow-lg p-0 w-full max-w-md">
    <form method="dialog" class="p-6 bg-white dark:bg-gray-800 flex flex-col gap-4">
      <h3 class="text-lg font-bold">Dziękujemy! 🎁</h3>
      <p class="text-sm text-gray-700 dark:text-gray-300">Twoje zamówienie zostało przyjęte. Wkrótce otrzymasz e‑mail z podsumowaniem i linkiem do strony wspomnienia.</p>
      <div class="flex justify-end"><button class="px-4 py-2 rounded-lg border">Zamknij</button></div>
    </form>
  </dialog>

  <!-- Biblioteka do QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>

  <!-- Logika strony (bezpośredni Supabase stub; można podmienić na /src/js/*) -->
  <script type="module">
    // (opcjonalnie) import klienta jeśli masz wspólny plik: const { supabase } = await import('/src/js/supabaseClient.js');
    // Jeśli nie — można utworzyć lokalnego klienta (wklejając ENV). Poniżej zostawiamy stuby i komentarze.

    // ===== Helpers =====
    const $  = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
    const toast = (msg, type='info') => {
      const el = $('#toast');
      const colors = { info:'bg-gray-900 text-white', ok:'bg-green-600 text-white', warn:'bg-yellow-500 text-black', error:'bg-red-600 text-white' };
      el.className = `fixed top-6 right-6 z-50 px-4 py-3 rounded-xl shadow-xl transition-all duration-300 ${colors[type]||colors.info}`;
      el.textContent = msg; el.style.opacity='1'; el.style.pointerEvents='auto';
      setTimeout(()=>{ el.style.opacity='0'; el.style.pointerEvents='none'; }, 2600);
    };

    const qrWrap = document.getElementById('qrPreview');
    const memorialForm = document.getElementById('memorialForm');
    const generateBtn = document.getElementById('generateBtn');
    const orderBtn = document.getElementById('orderBtn');

    // Generowanie QR (podgląd) — docelowo URL powinien wskazywać unikalną stronę wspomnienia, np.
    // https://www.happydate.pl/m/{uuid}
    async function renderQR(url){
      qrWrap.replaceChildren();
      try {
        await QRCode.toCanvas(url, { width: 220, margin: 2 }, (err, canvas) => {
          if (err) throw err;
          canvas.className = 'rounded-lg bg-white p-2 shadow';
          qrWrap.appendChild(canvas);
        });
      } catch (e) { console.error(e); toast('Nie udało się wygenerować QR', 'error'); }
    }

    generateBtn?.addEventListener('click', async () => {
      if (!memorialForm.reportValidity()) { toast('Uzupełnij wymagane pola', 'warn'); return; }
      // Tymczasowy URL podglądu (zanim powstanie rekord w bazie)
      const tempUUID = crypto.randomUUID();
      const previewUrl = `${location.origin}/m/${tempUUID}`;
      await renderQR(previewUrl);
      toast('Podgląd QR wygenerowany', 'ok');
    });

    memorialForm?.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!memorialForm.reportValidity()) return;

      orderBtn.disabled = true; orderBtn.classList.add('opacity-60','cursor-not-allowed');

      try {
        // 1) WALIDACJA minimalna
        const payload = {
          full_name: $('#fullName').value.trim(),
          lifespan: $('#lifespan').value.trim() || null,
          bio: $('#bio').value.trim(),
          plan: $('#plan').value,
          stickers: parseInt($('#stickers').value || '1', 10),
          email: $('#email').value.trim(),
          phone: $('#phone').value.trim() || null,
          // files: $('#photos').files & $('#videos').files — wgrywanie do Storage poniżej (TODO)
        };

        // 2) (Opcjonalnie) zapis do Supabase
        // const { data, error } = await supabase.from('memorials').insert({
        //   uuid: crypto.randomUUID(),
        //   ...payload,
        //   status: 'new',
        //   created_at: new Date().toISOString()
        // }).select('uuid').single();
        // if (error) throw error;
        // const pageUrl = `${location.origin}/m/${data.uuid}`;

        // 3) Upload plików do Supabase Storage (photos/, videos/) i przypisanie ich do rekordu memorials_media (TODO)

        // 4) Wysłanie maila potwierdzającego (Edge Function / API route) (TODO)

        // DEMO bez backendu:
        const pageUrl = `${location.origin}/m/${crypto.randomUUID()}`;
        await renderQR(pageUrl);

        document.getElementById('orderOk')?.showModal();
      } catch (e) {
        console.error(e);
        toast('Nie udało się złożyć zamówienia', 'error');
      } finally {
        orderBtn.disabled = false; orderBtn.classList.remove('opacity-60','cursor-not-allowed');
      }
    });
  </script>
</body>
</html>