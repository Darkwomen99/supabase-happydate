<!-- /pages/reviews.html -->
<!DOCTYPE html>
<html lang="pl" class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white transition-colors">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opinie użytkowników – HappyDate</title>
  <meta name="description" content="Przeczytaj i dodaj opinie o HappyDate. Twoja informacja zwrotna pomaga nam być jeszcze lepszymi!" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="https://unpkg.com/i18next@21.6.14/i18next.min.js"></script>
  <script src="https://unpkg.com/i18next-http-backend@1.4.1/i18nextHttpBackend.min.js"></script>
  <style>
    ::selection{background:#fde68a}
    textarea:focus{outline:none}
    @media (prefers-reduced-motion: reduce){.animate-pulse{animation:none!important}}
  </style>
</head>
<body class="overflow-x-hidden">

<!-- Header -->
<header class="bg-gradient-to-r from-blue-400 to-cyan-400 py-3 sm:py-4 sticky top-0 z-50 shadow-none">
  <div class="max-w-7xl mx-auto px-2 sm:px-4 md:px-8 flex justify-between items-center">
    <a href="/index.html" class="text-2xl font-bold text-white hover:underline" aria-label="HappyDate – Strona główna">🎁 HappyDate</a>
    <nav class="flex gap-4 text-white text-base">
      <a href="/index.html" data-i18n="header.home" class="hover:underline">Strona główna</a>
      <a href="/pages/services.html" data-i18n="header.services" class="hover:underline">Usługi</a>
      <a href="/pages/dashboard.html" data-i18n="header.dashboard" class="hover:underline">Moje wydarzenia</a>
      <a href="/pages/partnerstwo.html" data-i18n="header.partner" class="hover:underline">Partnerstwo</a>
      <a href="/pages/about.html" data-i18n="header.about" class="hover:underline">O nas</a>
      <span class="font-semibold underline" data-i18n="header.reviews">Opinie</span>
    </nav>
  </div>
</header>

<!-- Hero -->
<section class="bg-gradient-to-r from-pink-100 via-yellow-100 to-blue-100 py-14 text-center select-none" data-aos="fade-up">
  <div class="max-w-3xl mx-auto">
    <h1 class="text-4xl font-extrabold mb-4" data-i18n="reviews.title">Opinie naszych użytkowników 💬</h1>
    <p class="text-lg text-gray-700 mb-8" data-i18n="reviews.hero">
      Twoja opinia sprawia, że HappyDate staje się lepszy i jeszcze bardziej magiczny! Podziel się emocjami — dla nas to ważne!
    </p>
    <div class="text-[70px] sm:text-[90px] mb-2 animate-pulse" aria-hidden="true">💝</div>
  </div>
</section>

<!-- Form -->
<section class="max-w-2xl mx-auto px-4 -mt-16 mb-12 relative z-10" data-aos="fade-up">
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-pink-100 dark:border-gray-700">
    <h2 class="text-2xl font-semibold mb-4" data-i18n="reviews.formTitle">Dodaj swoją opinię</h2>
    <form id="review-form" class="space-y-4">
      <textarea id="review-text" rows="4" maxlength="333"
        class="w-full px-4 py-2 border rounded-lg resize-none focus:ring-2 focus:ring-pink-300 transition"
        placeholder="Podziel się swoją opinią..." required></textarea>
      <button type="submit"
        class="bg-pink-500 hover:bg-pink-600 text-white px-6 py-2 rounded-xl w-full font-semibold text-lg shadow transition active:scale-95">
        Wyślij opinię
      </button>
    </form>
    <p id="review-hint" class="mt-3 text-xs text-gray-500 hidden">
      Opinie zapisywane są w Supabase. Jeśli nie skonfigurujesz kluczy, przełączymy się na zapis w przeglądarce (MVP).
    </p>
  </div>
</section>

<!-- List -->
<section class="max-w-5xl mx-auto px-4 py-8" data-aos="fade-up">
  <h3 class="text-xl font-bold text-center mb-8" data-i18n="reviews.listTitle">Twoje opinie:</h3>
  <div id="reviews-list" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
</section>

<!-- Footer -->
<footer class="bg-blue-500 text-white py-6 mt-12 text-center text-sm md:text-base">
  <div data-i18n="footer.text">
    &copy; 2025 HappyDate. Z miłością tworzymy niezapomniane chwile.
  </div>
</footer>

<!-- Cookies -->
<div id="cookieConsent" class="fixed bottom-0 inset-x-0 bg-gray-800 bg-opacity-90 text-white py-4 px-6 z-50 hidden" role="dialog" aria-modal="true">
  <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
    <p class="text-sm md:text-base" data-i18n="cookies.text">
      Ta strona używa plików cookies, by ulepszyć Twój komfort. Korzystając dalej z serwisu, akceptujesz naszą
      <a href="/pages/privacy.html" class="underline hover:text-blue-300" target="_blank" rel="noopener">Politykę Prywatności</a>.
    </p>
    <button id="acceptCookies" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-md font-semibold transition" type="button">
      <span data-i18n="cookies.accept">Akceptuję</span>
    </button>
  </div>
</div>

<!-- App -->
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  // === UZUPEŁNIJ SWOIMI DANYMI (albo zostaw puste, wtedy fallback do localStorage) ===
  const SUPABASE_URL = ''; // np. 'https://abcd.supabase.co'
  const SUPABASE_ANON_KEY = ''; // public anon key
  // ================================================================================

  const supabase = (SUPABASE_URL && SUPABASE_ANON_KEY)
    ? createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
    : null;

  const useSupabase = !!supabase;
  const hint = document.getElementById('review-hint');
  if (hint) hint.classList.toggle('hidden', useSupabase);

  const reviewIcons = ["💖","✨","🌸","🎉","😊","💝","🥰","🎁","💌","⭐"];
  const rndIcon = () => reviewIcons[Math.floor(Math.random()*reviewIcons.length)];
  const $ = (s,r=document)=>r.querySelector(s);
  const listEl = $('#reviews-list');
  const formEl = $('#review-form');
  const txtEl  = $('#review-text');

  function toast(msg,type='ok'){
    const n=document.createElement('div');
    n.className=`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded shadow text-white ${type==='error'?'bg-red-600':'bg-green-600'}`;
    n.textContent=msg; document.body.appendChild(n); setTimeout(()=>n.remove(),2200);
  }

  function card({icon="💬", text="", date=""}){
    const div=document.createElement('div');
    div.className="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow hover:shadow-xl transition-all duration-300 text-left flex flex-col gap-3 border border-gray-100 dark:border-gray-700";
    div.innerHTML=`
      <div class="flex items-center gap-3 mb-2">
        <span class="text-2xl select-none">${icon}</span>
        <span class="text-xs text-gray-400 ml-auto">${date||''}</span>
      </div>
      <div class="text-base text-gray-800 dark:text-gray-200 break-words whitespace-pre-line"></div>
    `;
    div.querySelector('div > div:last-child').textContent = text;
    return div;
  }

  async function fetchReviews(){
    if (useSupabase){
      const { data, error } = await supabase
        .from('reviews')
        .select('id, text, icon, created_at')
        .order('created_at', { ascending: false })
        .limit(30);
      if (error) throw error;
      return (data||[]).map(r=>({
        text:r.text,
        icon:r.icon||"💬",
        date: new Date(r.created_at).toLocaleDateString('pl-PL')
      }));
    } else {
      return JSON.parse(localStorage.getItem('reviews')||'[]');
    }
  }

  async function addReview(text){
    const icon = rndIcon();
    if (useSupabase){
      const { data: { user } } = await supabase.auth.getUser().catch(()=>({data:{user:null}}));
      const { error } = await supabase.from('reviews').insert([{ text, icon, user_id: user?.id ?? null }]);
      if (error) throw error;
    } else {
      let arr = JSON.parse(localStorage.getItem('reviews')||'[]');
      arr.unshift({ text, icon, date: new Date().toLocaleDateString('pl-PL') });
      if (arr.length>30) arr = arr.slice(0,30);
      localStorage.setItem('reviews', JSON.stringify(arr));
    }
  }

  async function render(){
    listEl.replaceChildren();
    try{
      const items = await fetchReviews();
      if (!items.length){
        listEl.innerHTML = `<div class="col-span-full text-gray-500 text-center opacity-80">Brak opinii jeszcze 😔</div>`;
        return;
      }
      for(const r of items){ listEl.appendChild(card(r)); }
    }catch(e){ console.error(e); toast('Nie udało się załadować opinii','error'); }
  }

  formEl.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const text = txtEl.value.trim();
    if (!text){ toast('Proszę wprowadzić opinię!','error'); return; }
    try{
      await addReview(text);
      txtEl.value='';
      toast('Dziękujemy za opinię! 💛');
      render();
    }catch(err){
      console.error(err);
      toast('Błąd zapisu opinii','error');
    }
  });

  // i18n mini-init
  (function(){
    const supported = ["pl","ua","en","ru","de"];
    const browserLang = navigator.language?.slice(0,2) || "pl";
    const initial = localStorage.getItem("lang") || (supported.includes(browserLang) ? browserLang : "pl");
    i18next.use(i18nextHttpBackend).init({
      lng: initial, fallbackLng: "pl",
      backend:{ loadPath:"/assets/lang/{{lng}}.json" }
    }, (_, t) => {
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key=el.getAttribute("data-i18n");
        const val=t(key);
        if (val && val!==key) el.innerHTML=val;
      });
    });
  })();

  // Cookies
  (function(){
    const box=document.getElementById('cookieConsent');
    const btn=document.getElementById('acceptCookies');
    if(!localStorage.getItem('happydate_cookie_consent')) box.classList.remove('hidden');
    btn?.addEventListener('click', ()=>{ localStorage.setItem('happydate_cookie_consent','true'); box.classList.add('hidden'); });
  })();

  AOS.init({ duration: 700, once: true, offset: 60 });
  render();
</script>

</body>
</html>
